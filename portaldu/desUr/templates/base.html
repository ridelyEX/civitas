<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>{% block title %}Vinculación social{% endblock %}</title>

    {% block head %}
   <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
    crossorigin="anonymous"
  />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    {% endblock %}
</head>
<body>

    {% block body %}
    <main>
      <!-- Contenido principal -->
    </main>
    {% endblock %}

    {% block footer %}
    <footer>
        <!-- Pie de página -->
        <script>
            // Advertir antes de que expire la sesión
            const SESSION_TIMEOUT = {{ SESSION_COOKIE_AGE|default:3600 }} * 1000; // ms
            const WARNING_TIME = {{ SESSION_WARNING_TIME|default:300 }} * 1000; // ms

            let warningTimer;
            let logoutTimer;

            function resetTimers() {
                clearTimeout(warningTimer);
                clearTimeout(logoutTimer);

                // Advertencia 5 minutos antes
                warningTimer = setTimeout(() => {
                    const shouldStay = confirm(
                        '⚠️ Tu sesión está por expirar.\n\n' +
                        '¿Deseas continuar trabajando?'
                    );

                    if (shouldStay) {
                        // Renovar sesión con request al servidor
                        fetch(window.location.href, { method: 'HEAD' })
                            .then(() => resetTimers())
                            .catch(() => console.error('Error renovando sesión'));
                    }
                }, SESSION_TIMEOUT - WARNING_TIME);

                // Logout automático
                logoutTimer = setTimeout(() => {
                    alert('Tu sesión ha expirado. Serás redirigido al login.');
                    window.location.href = "{% url 'login' %}";
                }, SESSION_TIMEOUT);
            }

            // Reiniciar timers con actividad del usuario
            ['click', 'keypress', 'scroll', 'mousemove'].forEach(event => {
                document.addEventListener(event, () => {
                    resetTimers();
                }, { passive: true, once: false });
            });

            // Iniciar timers al cargar
            resetTimers();
        </script>
    </footer>
    {{ block.super }}
    {% endblock %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

</body>
</html>
