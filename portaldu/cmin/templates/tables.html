{% extends 'master.html' %}{% load static %}

{% block head %}
    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    <link rel="stylesheet" href="{% static 'cminStyles/tableStyles.css' %}?v=1">
{% endblock %}


{% block content %}{% include 'navmin.html' %}
<main class="container">
    <div class="cards">
      <div class="card">
        <h3>Asuntos pendientes</h3>
        <ul class="asuntos">
          {% for solicitud in solicitudesP %}
          <li>
              <form method="post" action="{% url 'saveSoli' %}">
                {% csrf_token %}
                  <input type="hidden" name="doc_id" value="{{ solicitud.fDoc_ID }}">
                  <strong>{{ solicitud.nomDoc }}</strong>
                  <p>{{ solicitud.fuuid }}</p>
                  <a href="{{ solicitud.finalDoc.url }}" target="_blank">Ver documentos</a>
                  <!--button type="submit" class="guardar-btn">Guardar</button-->
              </form>
          </li>
         {% empty %}
          <li><strong>No hay asuntos pendientes.</strong><p>No hay nuevas solicitudes.</p></li>
         {% endfor %}
        </ul>
      </div>

      <div class="card">
        <h3>Asuntos enviados</h3>
        <ul class="asuntos">
          {% for solicitud in solicitudesE %}
          <li>
              <strong>{{ solicitud.nomSolicitud }}</strong>
              <p>Enviado: {{ solicitud.fechaEnvio|date:"d/m/y" }}</p>
              <p>Folio: {{ solicitud.doc_FK.soli_FK.folio }}</p>
              <p>Destinatario: {{ solicitud.solicitud_FK.destinatario }}</p>
              <p>Enviado por: {{ solicitud.user_FK.username }}</p>

              <!--
               campos:
               Destinatario
               Folio  (a ver cómo mando el folio a la base de datos)
               -->
              <a href="{{ solicitud.doc_FK.finalDoc.url }}" target="_blank">Ver documento</a>
          </li>
           {% empty %}
          <li><strong>No hay asuntos enviados</strong><p>No hay solicitudes enviadas.</p></li>
           {% endfor %}
        </ul>
      </div>
    </div>

    <div class="acciones Ibottom">
        <button type="button" class="back bbtn" id="bback" data-url="{% url 'menu' %}">Regresar</button>
        <button type="button" class="enviar-btn" onclick="showSendForm()">Enviar asunto</button>
    </div>

    <!-- otro modal dios ayudame -->

    <div id="modal-sender" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>Enviar solicitud</h3>
            <form method="post" action="{% url 'send_mail' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="solicitud">Seleccione solicitud:</label>
                    <select name="solicitud_id" id="solicitud" class="form-control">
                        <option value="">-- Seleccione solicitud --</option>
                        {% for solicitud in solicitudesP %}
                        <option value="{{ solicitud.fDoc_ID }}">{{ solicitud.nomDoc }}</option>
                        {% endfor %}
                    </select>
                    <label for="cat">Seleccione una categoría:</label>
                    <select name="categorias" id="cat" class="form-control">
                        <option value="">-- Categorías de obras --</option>
                        <option value="Construcción">Construcción</option>
                        <option value="Rehabilitación">Rehabilitación</option>
                        <option value="Equipamiento">Equipamiento</option>
                        <option value="Elaboración">Elaboración</option>
                        <option value="Programa">Programa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="correo">Correo electrónico del destinatario:</label>
                    <input type="email" id="correo" name="correo" class="form-control">
                </div>
                <div class="form-group">
                    <label for="prioridad">Prioridad</label>
                    <select name="prioridad" id="prioridad">
                        {% for value, display in prioridad_choices  %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="mensaje">Mensaje:</label>
                    <textarea name="mensaje" id="mensaje" class="form-control" rows="4"></textarea>
                </div>
                    <button type="submit" class="enviar-btn">Enviar</button>
            </form>
        </div>
    </div>
</main>

{% endblock %}

{% block footer %}
<footer class="footer"></footer>

<script src="{% static 'cminScripts/cminBtns.js' %}"></script>

<script src="{% static 'cminScripts/cminModal.js' %}"></script>
{% endblock %}